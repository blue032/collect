<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>map</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    
    <style>
    #checkboxContainer {
    	position: absolute;
    	top: 100px; 
    	right: 10px; /*오른쪽에 정렬*/
    	z-index:100;
    	background-color: rgb(218, 240, 113);
    	padding: 10px;
    	border-radius: 5px;
    	max-width: 150px; /*최대너비지정*/
    }
    
    .checkboxGroup {
    	display: flex;
    	flex-direction: column;
    	margin-bottom: 5px;
    }
    
    .checkboxLabel {
    	margin: 2px 0; /*상하여백설정*/
    }
    
    </style>
    
</head>
<body>
<input type="button" value="데이터 가져오기" onclick="getData();">

<input type = "text" id = "date">
<script>

    let lineKey = 'true';
    let frontKey = 'true';
    let dangerKey = 'true';
    let pedestrianKey ='true';
    let searchTime = 10;

    $("#date").datepicker({dateFormat: 'yy-mm-dd'
        ,changeYear: true //콤보박스에서 년 선택 가능
        ,changeMonth: true //콤보박스에서 월 선택 가능
    });
</script>
<br/>
<br/>


<input id="lineCheckBox" type="checkbox" name="line" onchange="getLineData(this.value)"> 차선 이탈
<input id="pedestrianCheckBox" type="checkbox" name="pedestrian" onchange="getPedestrianData(this.value)"> 보행자 충돌
<input id="dangerCheckBox" type="checkbox" name="danger" onchange="getDangerData(this.value)"> 위험구간
<input id="frontCheckBox" type="checkbox" name="front" onchange="getFrontData(this.value)"> 전방추돌

<script>
       function getLineData(value) {
           lineKey = value;
           getData();
       }
       
       function getPedestrianData(value) {
           pedestrianeKey = value;
           getData();
       }
       
       function getDangerData(value) {
           dangerKey = value;
           getData();
       }
       
       function getFrontData(value) {
           frontKey = value;
           getData();
       }
       
</script>

<br/>
<br/>
<div id="map" style="width:1260px;height:600px;"></div>

<div id = "checkboxContainer">
	<div class = "checkboxGroup">
		<label class = "checkbox">
			<input id="lineCheckBox" type="checkbox" name="line" onchange="getLineData(this.value)"> 차선 이탈
		</label>
	</div>
	
	<div class = "checkboxGroup">
		<label class = "checkboxLabel">
			<input id="pedestrianCheckBox" type="checkbox" name="pedestrian" onchange="getPedestrianData(this.value)"> 보행자 충돌
		</label>
	</div>
	
		<div class = "checkboxGroup">
		<label class = "checkboxLabel">
			<input id="dangerCheckBox" type="checkbox" name="danger" onchange="getDangerData(this.value)"> 위험구간
		</label>
	</div>
	
	<div class = "checkboxGroup">
		<label class = "checkboxLabel">
			<input id="frontCheckBox" type="checkbox" name="front" onchange="getFrontData(this.value)"> 전방추돌
		</label>
	</div>
	
	
</div>

<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=3146c1c993d2fc8e50666c0efbf85f30&libraries=services,clusterer,drawing"></script>
<script>

    var container = document.getElementById('map');
    var checkbox = document.getElementById('line');
    var checkbox = document.getElementById('pedestrian');
    var checkbox = document.getElementById('danger');
    var checkbox = document.getElementById('front');
    var options = {
        center: new kakao.maps.LatLng(37.5642135, 127.0016985),
        level: 3
    };

    var map = new kakao.maps.Map(container, options);

    function getData() {

        $.ajax({
            type:'POST', //요청 메서드
            url: 'http://localhost:8080/datas/cits', //요청 URI //요청 헤더
            data: {
                "lineKey": lineKey,
                "frontKey": frontKey,
                "fromDate":"6",
                "toDate":"16"
            },
            dataType : 'json', //전송할 데이터 타입
            success : function(result) {//서버로부터 응답잉 도착하면 호출될 함수
                newMap(result);
            },
            error : function() {
                alert("error");
            } //에러가 발생했을 때 호출될 함수
        }); //$.ajax()
    }

    function newMap(data) {
        let result = data[0];
        let json1 = result[0];

        let vhcleLot = json1.vhcleLot;
        let vhcleLat = json1.vhcleLat;
        options = {
            center: new kakao.maps.LatLng(vhcleLat, vhcleLot),
            level: 3
        };

        map.container = container;
        map.options = options;

        for(let i = 0; i < result.length; i++){
            vhcleLot = result[i].vhcleLot;
            vhcleLat = result[i].vhcleLat;
            let imageSrc = '/icons/car.png', // 마커이미지의 주소입니다
                imageSize = new kakao.maps.Size(50, 25), // 마커이미지의 크기입니다
                imageOption = {offset: new kakao.maps.Point(27, 69)}; // 마커이미지의 옵션입니다. 마커의 좌표와 일치시킬 이미지 안에서의 좌표를 설정합니다.

// 마커의 이미지정보를 가지고 있는 마커이미지를 생성합니다
            let markerImage = new kakao.maps.MarkerImage(imageSrc, imageSize, imageOption),
                markerPosition = new kakao.maps.LatLng(vhcleLat, vhcleLot); // 마커가 표시될 위치입니다

// 마커를 생성합니다
            let marker = new kakao.maps.Marker({
                position: markerPosition,
                image: markerImage // 마커이미지 설정
            });
// 마커가 지도 위에 표시되도록 설정합니다
            marker.setMap(map)
        }
    }
    
// 체크박스 상태에 따라 마커 표시 여부를 제어
	checkbox.addEventListener("change",
		function () {
			if (checkbox.checked) {
				showMarkers(); 
			} else {
				hideMarkders();
			}
	});
	
	// 마커들을 생성하고 지도에 추가
	const markers = [];
	const markerPositions = [
		new kakao.map.LatLng(37.5665, 126.9780),
		new kakao.map.LatLng(35.6895, 139.6917),
		new kakao.map.LatLng(40.7128, -74.0060), 
	];
    
	for (const position of markerPositions) {
		const marker = new kakao.map.Marker({
			position: position,
		});
		markers.push(marker);
	}
	
	function showMarkers() {
		for(const marker of marker) {
			marker.setMap(map);
		}
	}
		
	function hideMarkers() {
		for(const marker of markers) {
			marker.setMap(null);
		}
	}
	

    window.onload = getData();
</script>



</body>
</html>